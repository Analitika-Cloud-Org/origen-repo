name: Sync to Bitbucket

on:
  # Se ejecuta cuando hay push a main
  push:
    branches: [ "main" ]
  # También permite ejecución manual
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Necesitamos todo el historial
      
      # Configurar las credenciales de Bitbucket
      - name: Sync to Bitbucket
        env:
          # Necesitarás configurar estos secrets en tu repositorio de GitHub
          BITBUCKET_USERNAME: ${{ secrets.BITBUCKET_USERNAME }}
          BITBUCKET_APP_PASSWORD: ${{ secrets.BITBUCKET_APP_PASSWORD }}
        run: |
          # Añadir el remote de Bitbucket
          git remote add bitbucket https://$BITBUCKET_USERNAME:$BITBUCKET_APP_PASSWORD@bitbucket.org:analitikacloud/destino-repo.git

          # Push a Bitbucket
          git push bitbucket --all --force
          git push bitbucket --tags --force